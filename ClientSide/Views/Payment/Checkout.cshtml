@{
    ViewData["Title"] = "Thanh toán Đơn hàng";
    var order = ViewBag.Order as ClientSide.Models.Order;
    var orderId = ViewBag.OrderId as int? ?? 0;
    var totalAmount = ViewBag.TotalAmount as decimal? ?? 0;
}

<div class="container" style="padding: 50px;">
    <h2>Xác nhận Thanh toán</h2>
    <hr />

    @if (order != null)
    {
        <div class="row">
            <div class="col-md-7">
                <h4>Thông tin đơn hàng</h4>
                <p><strong>Mã đơn:</strong> @order.OrderCode</p>
                <p><strong>Ngày tạo:</strong> @order.CreatedAt?.ToString("dd/MM/yyyy HH:mm")</p>
                <p><strong>Trạng thái:</strong> @order.OrderStatus</p>

                <h5 class="mt-4">Chi tiết sản phẩm</h5>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Sản phẩm</th>
                            <th>Số lượng</th>
                            <th>Đơn giá</th>
                            <th>Thành tiền</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (order.OrderDetails != null)
                        {
                            @foreach (var detail in order.OrderDetails)
                            {
                                <tr>
                                    <td>@detail.ProductName</td>
                                    <td>@detail.Quantity</td>
                                    <td>@string.Format("{0:N0} VNĐ", detail.Price)</td>
                                    <td>@string.Format("{0:N0} VNĐ", detail.TotalPrice)</td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>

            <div class="col-md-5">
                <div class="card p-3">
                    <h4>Tổng cộng</h4>
                    <h2 class="text-danger">@string.Format("{0:N0} VNĐ", totalAmount)</h2>
                    <hr />
                    <p>Chọn phương thức thanh toán:</p>

                    <form asp-action="ProcessPayment" asp-controller="Payment" method="post">
                        <input type="hidden" name="orderId" value="@orderId" />
                        <input type="hidden" name="totalAmount" value="@totalAmount" />

                        <button type="submit" class="btn btn-primary w-100">
                            Thanh toán VNPay
                        </button>
                    </form>

                    <a asp-action="Index" asp-controller="Orders" class="btn btn-secondary w-100 mt-2">
                        Quay lại
                    </a>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="alert alert-danger">
            Không tìm thấy thông tin đơn hàng!
        </div>
    }
</div>